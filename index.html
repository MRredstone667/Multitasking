<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>Multitasking</title>

<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Multitasking">

<style>
* {
  box-sizing: border-box;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}

body {
  margin: 0;
  background: #000;
  color: white;
  display: flex;
  flex-direction: column;
  height: 100vh;
}

/* TOP MODES */
#top {
  display: flex;
  justify-content: space-around;
  padding: 10px;
  background: #111;
}

#top button {
  background: none;
  border: none;
  color: #888;
  font-size: 16px;
}

#top button.active {
  color: #00aaff;
}

/* SCREEN */
#screen {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}

video {
  width: 90%;
  max-width: 360px;
  background: black;
}

#nosignal {
  position: absolute;
  font-size: 22px;
  color: #666;
}

/* STATUS */
#status {
  text-align: center;
  padding: 6px;
  font-size: 14px;
  color: #aaa;
}

/* CONTROLS */
#controls {
  display: flex;
  justify-content: space-around;
  padding: 10px;
}

.start {
  background: green;
  border: none;
  color: white;
  padding: 10px 20px;
  border-radius: 8px;
}

.stop {
  background: darkred;
  border: none;
  color: white;
  padding: 10px 20px;
  border-radius: 8px;
}

.hidden {
  display: none;
}

input, textarea {
  width: 90%;
  background: #111;
  color: white;
  border: 1px solid #333;
  padding: 8px;
  margin-top: 10px;
}
</style>
</head>

<body>

<!-- MODE SWITCH -->
<div id="top">
  <button onclick="setMode('media')" class="active">Video / Foto</button>
  <button onclick="setMode('yt')">YT Video</button>
  <button onclick="setMode('notes')">Poznámky</button>
</div>

<!-- SCREEN -->
<div id="screen">
  <video id="video" playsinline autoplay></video>
  <div id="nosignal">No signal :(</div>
</div>

<!-- INPUTS -->
<div id="inputs" style="text-align:center;">
  <input type="file" id="fileInput" accept="video/*,image/*">
  <input type="text" id="ytInput" class="hidden" placeholder="YouTube URL">
  <textarea id="notesInput" class="hidden" placeholder="Napiš poznámku..."></textarea>
</div>

<!-- STATUS -->
<div id="status">ready</div>

<!-- CONTROLS -->
<div id="controls">
  <button class="start" onclick="start()">START</button>
  <button class="stop" onclick="stop()">STOP</button>
</div>

<canvas id="canvas" hidden></canvas>

<script>
let mode = 'media';
let stream;
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const nosignal = document.getElementById("nosignal");
const status = document.getElementById("status");

function setMode(m) {
  mode = m;
  document.querySelectorAll("#top button").forEach(b => b.classList.remove("active"));
  event.target.classList.add("active");

  document.getElementById("fileInput").classList.toggle("hidden", m !== 'media');
  document.getElementById("ytInput").classList.toggle("hidden", m !== 'yt');
  document.getElementById("notesInput").classList.toggle("hidden", m !== 'notes');
}

function start() {
  nosignal.style.display = "none";

  if (mode === 'media') {
    const file = fileInput.files[0];
    if (!file) return status.textContent = "select media";

    if (file.type.startsWith("video")) {
      video.src = URL.createObjectURL(file);
      video.loop = true;
      video.play();
      status.textContent = "video playing";
    } else {
      const img = new Image();
      img.src = URL.createObjectURL(file);
      img.onload = () => fakeStream(() => {
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      });
    }
  }

  if (mode === 'notes') {
    const text = notesInput.value || " ";
    fakeStream(() => {
      ctx.fillStyle = "black";
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = "white";
      ctx.font = "20px sans-serif";
      ctx.fillText(text, 10, 50);
    });
  }

  status.textContent = "stream running";
}

function fakeStream(draw) {
  canvas.width = 360;
  canvas.height = 640;

  stream = canvas.captureStream(30);
  video.srcObject = stream;

  function loop() {
    draw();
    requestAnimationFrame(loop);
  }
  loop();
}

function stop() {
  if (stream) stream.getTracks().forEach(t => t.stop());
  video.src = "";
  video.srcObject = null;
  nosignal.style.display = "block";
  status.textContent = "stopped";
}
</script>

</body>
</html>
